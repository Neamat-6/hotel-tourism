<?xml version="1.0" encoding="UTF-8"?>
<templates id="point_of_sale.template" xml:space="preserve">

  <t t-name="OrderReceipt" t-inherit="point_of_sale.OrderReceipt" t-inherit-mode="extension" owl="1">
    <xpath expr="//t[@t-if='!isTaxIncluded']" position="before">
        <t t-set="discountLines" t-value="receipt.orderlines.filter(line => line.is_discount)"/>
        <t t-set="serviceChargeLines" t-value="receipt.orderlines.filter(line => line.is_service_charge)"/>
        <t t-set="totalDiscount" t-value="discountLines.reduce((acc, line) => acc + line.price_without_tax, 0)"/>
        <t t-set="totalServiceCharge" t-value="serviceChargeLines.reduce((acc, line) => acc + line.price_without_tax, 0)"/>
        <t t-if="totalDiscount">
            <div>Discount<span t-esc="env.pos.format_currency(totalDiscount)" class="pos-receipt-right-align"/></div>
        </t>
        <t t-if="totalServiceCharge">
            <div>Service<span t-esc="env.pos.format_currency(totalServiceCharge)" class="pos-receipt-right-align"/></div>
        </t>

    </xpath>
  </t>

  <t t-name="OrderLinesReceipt" t-inherit="point_of_sale.OrderLinesReceipt" t-inherit-mode="extension" owl="1">
    <xpath expr="//t[@t-foreach='receipt.orderlines']" position="attributes">
        <attribute name="t-foreach">receipt.orderlines.filter(line => !line.is_discount and !line.is_service_charge)</attribute>
    </xpath>
  </t>

</templates>