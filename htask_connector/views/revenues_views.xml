<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <data>
        <record id="view_move_form_htask_invoices" model="ir.ui.view">
            <field name="name">account.payment.form</field>
            <field name="model">account.payment</field>
            <field name="inherit_id" ref="account.view_account_payment_form"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='journal_id']" position="after">
                    <field name="htask_payment_name"/>
                </xpath>
            </field>
        </record>
        <record id="view_move_tree_htask_invoices" model="ir.ui.view">
            <field name="name">account.invoice.tree</field>
            <field name="model">account.move</field>
            <field name="arch" type="xml">
                <tree string="Invoices"
                      decoration-info="state == 'draft'"
                      decoration-muted="state == 'cancel'"
                      banner_route="/account/account_invoice_onboarding"
                      js_class="account_tree">
                    <field name="name"/>
                    <field name="partner_id" invisible="1"/>
                    <field name="invoice_source_email" invisible="1"/>
<!--                    <field name="invoice_partner_display_name" string=" "/>-->
                    <field name="invoice_partner_display_name" invisible="context.get('default_move_type') not in ('in_invoice', 'in_refund','in_receipt')" groups="base.group_user" string="Vendor" />
                    <field name="invoice_partner_display_name" invisible="context.get('default_move_type') not in ('out_invoice', 'out_refund','out_receipt')" groups="base.group_user" string="Customer" />
                    <field name="invoice_date" optional="show" invisible="context.get('default_move_type') not in ('in_invoice', 'in_refund','in_receipt')" string="Bill Date"/>
                    <field name="invoice_date" optional="show" invisible="context.get('default_move_type') not in ('out_invoice', 'out_refund','out_receipt')" string="Invoice Date"/>
                    <field name="invoice_origin" optional="show" string="Source Document"/>
<!--                    <field name="invoice_payment_ref" optional="hide" invisible="context.get('default_move_type') in ('out_invoice', 'out_refund','out_receipt')"/>-->
                    <field name="ref" optional="hide"/>
                    <field name="invoice_user_id" optional="show" invisible="context.get('default_move_type') not in ('out_invoice', 'out_refund','out_receipt')" string="Sales Person"/>
                    <field name="company_id" groups="base.group_multi_company" options="{'no_create': True}" optional="show"/>
                    <field name="branch_id" groups="branch.group_multi_branch" options="{'no_create': True}" optional="show"/>
                    <field name="invoice_date_due" optional="show"/>
                    <field name="amount_untaxed_signed" string="Tax Excluded" sum="Total" optional="show"/>
                    <field name="amount_tax_signed" string="Tax" sum="Total" optional="hide"/>
                    <field name="amount_total_signed" string="Total" sum="Total" optional="show"/>
                    <field name="amount_residual_signed" string="Amount Due" sum="Amount Due" optional="show"/>
                    <field name="currency_id" invisible="1"/>
                    <field name="company_currency_id" invisible="1"/>
                    <field name="state" optional="show"/>
                    <field name="payment_state" optional="hide"/>
                    <field name="move_type" invisible="context.get('default_move_type', True)"/>
                </tree>
            </field>
        </record>

        <record id="action_move_htask_out_invoice" model="ir.actions.act_window">
            <field name="name">Invoices</field>
            <field name="res_model">account.move</field>
            <field name="view_mode">tree,kanban,form</field>
            <field name="view_id" ref="view_move_tree_htask_invoices"/>
            <field name="search_view_id" ref="account.view_account_invoice_filter"/>
<!--            <field name="domain">[('type', '=', 'out_invoice')</field>-->
            <field name="domain">[('move_type', '=', 'out_invoice'), ('is_htask_move', '=', True)]</field>
            <field name="context">{'default_move_type': 'out_invoice'}</field>
            <field name="help" type="html">
              <p class="o_view_nocontent_smiling_face">
                No invoices have been created yet!
              </p>
            </field>
        </record>

        <!-- HTask Revenues list view -->
        <record id="view_move_line_tree_htask_revenues" model="ir.ui.view">
            <field name="name">account.move.line.tree.htask.revenues</field>
            <field name="model">account.move.line</field>
            <!-- <field name="inherit_id" ref="account.view_move_line_tree"/> -->
            <field name="arch" type="xml">
                <tree string="Revenues" create="false" edit="false">
                    <field name="name" optional="show" string="Revenue Name"/>
                    <field name="account_id" options="{'no_open': True}" groups="account.group_account_user"/>
                    <field name="partner_id" optional="show" string="Guest"/>
                    <field name="date" optional="show"/>
                    <field name="company_id" groups="base.group_multi_company"/>
                    <field name="branch_id" groups="branch.group_multi_branch"/>
                    <field name="journal_id" invisible="1" options="{&quot;no_open&quot;:True}"/>
                    <field name="move_id" invisible="1" optional="show"/>
                    <field name="statement_id" invisible="1"/>
                    <field name="ref" invisible="1" optional="show"/>
                    <field name="analytic_account_id" invisible="1" groups="account.group_account_user" optional="show"/>
                    <field name="analytic_tag_ids" widget="many2many_tags" groups="analytic.group_analytic_tags" optional="hide"/>
                    <field name="tax_ids" invisible="1" widget="many2many_tags" width="0.5" optional="show"/>
                    <field name="debit" sum="Total Debit" invisible="1"/>
                    <field name="credit" sum="Total Credit" invisible="1"/>
                    <field name="balance_abs" string="Balance" sum="Total Balance" widget="monetary"/>
                    <field name="amount_currency" groups="base.group_multi_currency" optional="hide"/>
<!--                    <field name="foreign_currency_id" readonly="1" groups="base.group_multi_currency" optional="hide" string="Original Currency"/>-->
                    <field name="tax_tag_ids" widget="many2many_tags" width="0.5" optional="hide"/>
                    <field name="full_reconcile_id" invisible="1" optional="show"/>
                    <field name="reconcile_model_id" invisible="1"/>
                    <field name="reconciled" invisible="1"/>
                    <field name="date_maturity" optional="hide"/>
                    <field name="currency_id" readonly="1" invisible="1"/>
                    <field name="company_currency_id" invisible="1"/>
                    <field name="parent_state" invisible="1"/>
                </tree>
            </field>
        </record>
        
        <record id="action_account_revenues_all" model="ir.actions.act_window">
            <!-- <field name="context">{'journal_type':'general', 'search_default_posted':1}</field> -->
            <field name="name">Revenues</field>
            <field name="res_model">account.move.line</field>
            <field name="domain">[('is_htask_line', '=', True), ('display_type', 'not in', ('line_section', 'line_note')), ('move_id.state', '!=', 'cancel')]</field>
            <field name="view_id" ref="view_move_line_tree_htask_revenues"/>
            <field name="view_mode">tree,pivot,graph,form,kanban</field>
        </record>
        
        <!-- HTask Revenues MenuItem -->
        <menuitem id="htask_revenues_menuitem" sequence="2" parent="htask_connector.htask_connector_root_menu" action="action_account_revenues_all" name="Revenues" groups="htask_connector.htask_connector_manager_group"/>

        <menuitem id="htask_invoices_menuitem" sequence="3" parent="htask_connector.htask_connector_root_menu" action="action_move_htask_out_invoice" name="Invoices" groups="htask_connector.htask_connector_manager_group"/>
    </data>
    

</odoo>
