<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">
    <t t-name="os_theme_butterfly.ControlPanelMobile" owl="1">
        <div class="o_control_panel os_legacy_control_panel_mobile" t-on-switch-view="_onSwitchView">
            <t t-if="state.showMobileSearch">
                <Portal target="'body'">
                    <div class="o_searchview os_modal_mobile_search">
                        <div class="os_modal_mobile_search_header">
                            <button type="button" class="btn-link btn" t-on-click="state.showMobileSearch = false"
                                    title="BACK">
                                <t t-call="os_theme_butterfly.search_back_2"/>
                            </button>
                            <button type="button" class="btn-link btn" t-on-click="model.dispatch('clearQuery')"
                                    title="CLEAR SEARCH">
                                CLEAR
                            </button>
                        </div>
                        <div class="os_mobile_search_wrapper">
                            <SearchBar t-if="props.withSearchBar" fields="fields"/>
                            <div class="os_mobile_search_options o_search_options" t-ref="searchViewButtons">
                                <FilterMenu t-if="props.searchMenuTypes.includes('filter')" class="o_filter_menu"
                                            fields="fields"/>
                                <GroupByMenu t-if="props.searchMenuTypes.includes('groupBy')" class="o_group_by_menu"
                                             fields="fields"/>
                                <ComparisonMenu
                                        t-if="props.searchMenuTypes.includes('comparison') and model.get('filters', f => f.type === 'comparison').length"
                                        class="o_comparison_menu"/>
                                <FavoriteMenu t-if="props.searchMenuTypes.includes('favorite')"
                                              class="o_favorite_menu"/>
                            </div>
                        </div>
                        <button type="button" class="btn btn-secondary btn-block rounded-0"
                                t-on-click="state.showMobileSearch = false">
                            <t>RESULT</t>
                        </button>
                    </div>
                </Portal>
            </t>
            <t t-else="">
                <div class="o_cp_top">
                    <t t-if="props.withBreadcrumbs and !state.showSearchBar">
                        <ol class="breadcrumb" role="navigation">
                            <t t-set="breadcrumb" t-value="props.breadcrumbs[props.breadcrumbs.length - 1]"/>
                            <li t-if="breadcrumb" class="breadcrumb-item o_back_button btn btn-link" accesskey="b"
                                t-on-click.prevent="trigger('breadcrumb_clicked', { controllerID: breadcrumb.controllerID })"/>
                            <li class="breadcrumb-item active" t-esc="props.title"/>
                        </ol>
                    </t>

                    <div class="o_cp_searchview"
                         t-att-class="{ os_searchview_mobile: state.showSearchBar or !props.withBreadcrumbs }"
                         role="search" t-ref="searchView">
                        <div t-if="props.withSearchBar" class="o_searchview" role="search" aria-autocomplete="list">
                            <t t-if="!state.showMobileSearch">
                                <t t-if="props.withBreadcrumbs">
                                    <button type="button"
                                            class="os_trigger_searchview btn text-body btn-link pr-0 font-weight-bold"
                                            t-on-click="state.showSearchBar = !state.showSearchBar">
                                        <i class="osi"
                                           t-att-class="state.showSearchBar ? 'osi-arrow-left' : 'osi-search'"/>
                                    </button>
                                </t>

                                <t t-if="state.showSearchBar or !props.withBreadcrumbs">
                                    <SearchBar t-if="props.withSearchBar" fields="fields"/>
                                    <button type="button" class="btn osi osi-filter-fill"
                                            t-on-click="state.showMobileSearch = !state.showMobileSearch"/>
                                </t>
                            </t>
                        </div>
                    </div>
                </div>
                <div t-if="props.actionMenus and props.actionMenus.items and env.view and env.view.type == 'list'"
                     class="o_cp_bottom ml-auto align-items-center ml-n2">
                    <ActionMenus t-props="props.actionMenus"/>
                </div>
                <div t-else="" class="o_cp_bottom">
                    <div class="o_cp_bottom_left">
                        <div class="o_cp_buttons" role="toolbar" aria-label="Control panel toolbar" t-ref="buttons">
                            <t t-slot="buttons"/>
                        </div>
                    </div>
                    <div class="o_cp_bottom_right">
                        <div class="btn-group o_search_options position-static" role="search"
                             t-if="!props.withSearchBar" t-ref="searchViewButtons"/>
                        <t t-if="env.view and env.view.type === 'calendar'">
                            <button class="ml-auto text-body btn btn-link btn-sm" title="Today" t-on-click="trigger('today-button-click')">
                                <i class="osi osi-calendar-check-fill text-primary fa-lg"/>
                            </button>
                        </t>
                        <t t-else="">
                            <div class="o_cp_pager" role="search" t-ref="pager">
                                <Pager t-if="props.pager and props.pager.limit" t-props="props.pager"/>
                            </div>
                        </t>

                        <nav t-if="props.views and props.views.length gt 1" class="btn-group o_cp_switch_buttons"
                             t-att-class="{ show: state.showViewSwitcher }" role="toolbar"
                             aria-label="View switcher">
                            <button type="button" class="os_selected_view_btn text-body btn btn-link btn-sm pr-0" title="Change View"
                                    t-attf-aria-expanded="{{ state.showViewSwitcher ? 'true' : 'false' }}"
                                    t-on-click="state.showViewSwitcher = !state.showViewSwitcher">
                                <span class="fa fa-lg"
                                      t-att-class="props.views.find(v => v.type === env.view.type).icon"/>
                            </button>
                            <ul t-if="state.showViewSwitcher"
                                class="dropdown-menu dropdown-menu-right p-2 list-inline"
                                t-att-class="{ show: state.showViewSwitcher }">
                                <li t-foreach="props.views" t-as="view" t-key="view.type">
                                    <t t-call="web.ViewSwitcherButton"/>
                                </li>
                            </ul>

                        </nav>
                        <ActionMenus t-if="props.actionMenus and props.actionMenus.items" t-props="props.actionMenus"/>
                    </div>
                </div>
            </t>
        </div>
    </t>

    <!-- Legacy control panel templates -->
    <t t-inherit="web.Legacy.ControlPanel" t-inherit-mode="extension" owl="1">
         <xpath expr="//SearchBar" position="attributes">
             <attribute name="isToggleSearch">true</attribute>
        </xpath>
        <xpath expr="//div[hasclass('o_control_panel')]" position="attributes">
            <attribute name="t-attf-class" add="os_panel_view_{{env.view and env.view.type}} os_legacy_control_panel" separator=" "/>
            <attribute name="t-if" add="!isMobile" separator=" "/>
        </xpath>
        <xpath expr="//div[hasclass('o_cp_top_left')]//ol" position="before">
            <h3 class="os-block-title page-title my-2">
                <span t-if="props.title" t-esc="props.title"/>
            </h3>
        </xpath>
        <xpath expr="//div[hasclass('o_cp_top_right')]//div[hasclass('o_cp_searchview')]" position="attributes">
             <attribute name="t-att-data-search" add="props.withSearchBar ? 'odoo-search' : ''" separator=" "/>
            <attribute name="t-att-class" add="props.withSearchBar ? 'search-wrap' : ''" separator=" "/>
        </xpath>
        <xpath expr="//div[hasclass('o_cp_top_right')]//div[hasclass('o_cp_searchview')]" position="after">
            <a t-if="props.withSearchBar" t-on-click="openSearch" class="btn btn-light search-toggle toggle-search ml-auto"
               data-target="odoo-search" title="Click to open search">
                <i class="small mr-1 fa fa-search"/>
                <span class="o_dropdown_title font-weight-bold">Search</span>
            </a>
        </xpath>
        <xpath expr="//div[hasclass('o_cp_bottom_left')]//div[hasclass('o_cp_buttons')]" position="after">
            <t t-if="env.view and env.view.type != 'calendar' and env.view.type != 'activity' and env.view.model!='ir.module.module'">
                <button type="button" class="os_reload_view btn btn-dim btn-outline-light" title="Reload view">
                    <em class="osi osi-reload"/>
                </button>
            </t>
        </xpath>

        <xpath expr="//div[hasclass('o_cp_bottom_right')]//div[hasclass('o_search_options')]" position="replace"/>

        <xpath expr="//div[hasclass('o_cp_top_right')]" position="after">
            <div class="o_search_options position-static d-flex"
                 role="search"
                 t-ref="searchViewButtons">
                <t t-if="props.withSearchBar">
                    <FilterMenu t-if="props.searchMenuTypes.includes('filter')"
                                class="o_filter_menu ml-1"
                                fields="fields"
                    />
                    <GroupByMenu t-if="props.searchMenuTypes.includes('groupBy')"
                                 class="o_group_by_menu ml-1"
                                 fields="fields"
                    />
                    <ComparisonMenu t-if="props.searchMenuTypes.includes('comparison') and model.get('filters', f => f.type === 'comparison').length"
                                    class="o_comparison_menu ml-1"
                    />
                    <FavoriteMenu t-if="props.searchMenuTypes.includes('favorite')"
                                  class="o_favorite_menu ml-1"
                    />
                </t>
            </div>
        </xpath>
        <xpath expr="//div[hasclass('o_control_panel')]" position="after">
            <t t-else="">
                <t t-call="os_theme_butterfly.ControlPanelMobile"/>
            </t>
        </xpath>
    </t>
</templates>